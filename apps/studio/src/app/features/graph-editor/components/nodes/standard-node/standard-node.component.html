<!-- Node Card -->
<div
	class="w-[280px] min-w-[240px] max-w-[320px] rounded-lg bg-card border shadow-sm overflow-hidden"
	[class.border-primary]="selected()"
	[class.shadow-md]="selected()"
	[class.border-border]="!selected()"
>
	<!-- Node Header -->
	<header
		class="flex items-center justify-between px-3 py-2 bg-muted/30 border-b border-border/50 cursor-move"
		dragHandle
	>
		<!-- Target handle inside header so it positions at header level -->
		<handle
			[id]="'node-' + data()?.id"
			type="target"
			position="left"
			[offsetX]="12"
			[template]="targetHandler.templateRef()"
		/>
		<h5 class="flex-1 text-sm font-semibold text-foreground tracking-tight truncate text-left">
			{{ data()?.name }}
		</h5>
		<mmc-badge variant="secondary" class="ring-1 text-muted-foreground ring-ring"
			>Standard</mmc-badge
		>
	</header>

	<!-- Node Body -->
	<div class="p-3">
		<!-- Actions List -->
		@if (data()?.actions?.length) {
			<div class="space-y-1.5">
				@for (action of data()?.actions; track action.id || $index) {
					<!-- Regular action (no outputs) -->
					@if (action.type !== ActionType.Transition) {
						<div
							class="flex items-center gap-2 px-2 py-1.5 rounded-md border border-border/50 bg-background hover:bg-muted/30 transition-colors text-xs"
						>
							<mmc-icon
								[name]="getActionIcon(action.type)"
								size="xs"
								class="text-primary shrink-0"
							></mmc-icon>
							<span class="truncate text-foreground font-medium flex-1">
								{{ action.content || action.label || getActionLabel(action.type) }}
							</span>
						</div>
					}

					<!-- Transition action with output options -->
					@if (action.type === ActionType.Transition) {
						<div
							class="rounded-md border border-border/50 bg-background text-xs overflow-hidden"
						>
							<!-- Transition header row -->
							<div class="flex items-center gap-2 px-2 py-1.5">
								<mmc-icon
									name="lucideGitBranch"
									size="xs"
									class="text-primary shrink-0"
								></mmc-icon>
								<span class="text-foreground font-medium">
									{{ action.label || 'Transition' }}
								</span>
							</div>

							<!-- Output options inside the bordered container -->
							@if (action.options?.length) {
								<div class="border-t border-border/30">
									@for (option of action.options; track option.id) {
										<div
											class="flex items-center justify-end gap-1 px-2 py-1.5 text-muted-foreground"
										>
											<span class="truncate">{{ option.label }}</span>
											<!-- Handle inside the row so it positions based on this element -->
											<handle
												[id]="'transition-' + action.id + '-' + option.id"
												type="source"
												position="right"
												[offsetX]="-12"
												[template]="sourceHandler.templateRef()"
											/>
										</div>
									}
								</div>
							}
						</div>
					}
				}
			</div>
		}
	</div>
</div>

<!-- Handler templates -->
<mmc-handler #targetHandler></mmc-handler>
<mmc-handler #sourceHandler></mmc-handler>
