<div class="relative">
	<!-- Input field with search functionality -->
	<div class="relative" mmcPopoverOrigin #origin="mmcPopoverOrigin">
		<mmc-input-search
			#inputSearch
			[placeholder]="placeholder()"
			[debounceTime]="debounceTime()"
			[(query)]="searchQuery"
			(queryChange)="onSearchChange($event)"
			(focus)="onInputFocus()"
			(blur)="onBlur()"
			[class]="
				disabled() ? 'w-full pointer-events-none opacity-50' : 'w-full'
			"
		/>
	</div>

	<!-- Options dropdown -->
	<mmc-popover
		[outsideClose]="true"
		[restoreFocus]="false"
		[blockScroll]="true"
		[styled]="true"
		[stretchToOrigin]="true"
		(closed)="panelClosed()"
		[(isOpen)]="isOpen"
		[origin]="origin"
		[offsetY]="4"
		[positionY]="positionY()"
	>
		<ng-template>
			@if (loading()) {
				<!-- Loading state -->
				<div
					class="border-input bg-popover text-popover-foreground relative z-50 w-full min-w-32 rounded-md border shadow-lg"
				>
					<div class="flex items-center justify-center p-4">
						<mmc-spinner size="sm" class="mr-2" />
						<span class="text-sm text-muted-foreground"
							>Loading...</span
						>
					</div>
				</div>
			} @else if (options().length > 0) {
				<!-- Options list -->
				<div
					class="border-input bg-popover text-popover-foreground relative z-50 w-full min-w-32 rounded-md border shadow-lg max-h-60 overflow-y-auto"
				>
					<div
						class="p-1"
						role="listbox"
						[attr.aria-label]="placeholder()"
					>
						@for (option of options(); track option.value) {
							<button
								type="button"
								role="option"
								class="w-full text-left px-3 py-2 text-sm rounded hover:bg-muted transition-colors disabled:opacity-50 disabled:cursor-not-allowed focus:bg-muted focus:outline-none"
								[class.bg-muted]="
									selectedOption()?.value === option.value
								"
								[disabled]="option.disabled"
								(click)="selectOption(option)"
								(mousedown)="$event.preventDefault()"
							>
								{{ option.label }}
							</button>
						}
					</div>
				</div>
			}
		</ng-template>
	</mmc-popover>
</div>
