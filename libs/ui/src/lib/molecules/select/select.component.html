<button
	type="button"
	mmcButton
	mmcPopoverOrigin
	#origin="mmcPopoverOrigin"
	variant="outline"
	(click)="togglePanel()"
	[disabled]="disabled()"
	[loading]="loading()"
	[class]="classNames()"
>
	<div class="inline-flex items-center">
		@if (selectedOptionsLabel(); as selectedOptionsLabel) {
			@if (templateLabel(); as templateLabel) {
				<ng-container
					*ngTemplateOutlet="
						templateLabel.templateRef;
						context: { $implicit: selectedOptions() }
					"
				></ng-container>
			} @else {
				<span class="flex-1 truncate text-left">
					{{ selectedOptionsLabel }}
				</span>
			}
		} @else {
			{{ placeholder() }}
		}
	</div>
	@if (withIcon()) {
		<mmc-icon
			name="lucideChevronDown"
			size="sm"
			class="ml-2 duration-300"
			[ngClass]="{
				'rotate-180': isOpen(),
			}"
		/>
	}
</button>
<mmc-popover
	[outsideClose]="true"
	[restoreFocus]="true"
	[blockScroll]="true"
	[styled]="true"
	[stretchToOrigin]="true"
	(opened)="panelOpened()"
	(closed)="panelClosed()"
	[(isOpen)]="isOpen"
	[origin]="origin"
	[offsetY]="8"
	[positionY]="positionY()"
>
	<ng-template>
		<div
			[ariaMultiSelectable]="multiple()"
			[attr.aria-activedescendant]="activeDescendantId()"
			tabindex="0"
			#selectOption
			(keydown)="onKeydown($event)"
			class="border-input bg-popover text-popover-foreground relative z-50 max-h-52 min-w-32 overflow-y-auto rounded-md border shadow-lg p-1 [&_[role=group]]:py-1"
			role="listbox"
		>
			<ng-content select="mmc-option-group"></ng-content>
			<ng-content select="mmc-option"></ng-content>
		</div>
	</ng-template>
</mmc-popover>
