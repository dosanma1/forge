# Forge Framework - Code Generation Engine

**Version:** 1.0.0
**Status:** Active
**Last Updated:** 2026-01-28

---

## Template System

Templates use Go's `text/template` with custom functions.

**Template Functions**:

```go
// String manipulation
"camelCase":   toCamelCase,
"pascalCase":  toPascalCase,
"snakeCase":   toSnakeCase,
"kebabCase":   toKebabCase,

// Type conversion
"goType":      toGoType,
"gormType":    toGormType,
"protoType":   toProtoType,
"jsonAPIType": toJSONAPIType,

// Code generation helpers
"imports":     collectImports,
"deps":        collectDependencies,
```

---

## Generation Pipeline

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  Load       │────►│  Validate   │────►│   Build     │
│  forge.json │     │  Schema     │     │   Graph     │
└─────────────┘     └─────────────┘     └─────────────┘
                                               │
                                               ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  Write      │◄────│  Format     │◄────│  Execute    │
│  Files      │     │  (gofmt)    │     │  Templates  │
└─────────────┘     └─────────────┘     └─────────────┘
                           │
                           ▼
                    ┌─────────────┐
                    │  Run        │
                    │  Gazelle    │
                    └─────────────┘
```

---

## Generated Code Headers

All generated files include:

```go
// Code generated by Forge Framework v1.0.0. DO NOT EDIT.
// Source: forge.json
// Generated at: 2026-01-26T10:00:00Z
//
// To modify this code, update the Forge project definition and regenerate.
// Manual changes will be overwritten on next generation.
```

---

## Template Files

Located in `forge-cli/templates/`:

| Template                 | Output                  | Description                   |
| ------------------------ | ----------------------- | ----------------------------- |
| `entity.go.tmpl`         | `{entity}.go`           | Entity with Repo/Usecase/Ctrl |
| `transport_rest.go.tmpl` | `{entity}_transport.go` | REST handlers with JSON:API   |
| `transport_grpc.go.tmpl` | `{entity}_grpc.go`      | gRPC service implementation   |
| `transport_nats.go.tmpl` | `{entity}_nats.go`      | NATS producer/consumer        |
| `module.go.tmpl`         | `module.go`             | Fx module wiring              |
| `migration.sql.tmpl`     | `YYYYMMDD_init.up.sql`  | Database migration            |
| `build.bazel.tmpl`       | `BUILD.bazel`           | Bazel build file              |

---

## Generated File Structure

```
my-service/
├── forge.json                        # Project definition
├── .sops.yaml                        # SOPS configuration
├── secrets/
│   └── dev.enc.yaml                  # Encrypted secrets example
├── docs/
│   └── openapi.yaml                  # Auto-generated OpenAPI spec
├── cmd/
│   ├── server/
│   │   ├── BUILD.bazel              # Generated
│   │   └── main.go                  # Generated
│   └── migrator/
│       ├── BUILD.bazel              # Generated
│       ├── main.go                  # Generated
│       └── migrations/
│           └── YYYYMMDD_init.up.sql # Generated
├── internal/
│   ├── BUILD.bazel                  # Generated
│   ├── doc.go                       # Generated
│   ├── module.go                    # Generated - Fx wiring
│   ├── types.go                     # Generated - Constants
│   │
│   ├── user.go                      # Generated - Entity
│   ├── user_transport.go            # Generated - Transport
│   ├── user_custom.go               # Manual - Custom logic (preserved)
│   │
│   └── mocks/                       # Generated by mockery
│       └── user_repository_mock.go
├── pkg/
│   ├── api/pb/user/v1/              # Generated gRPC code
│   │   ├── BUILD.bazel
│   │   └── user.pb.go
│   └── proto/user/v1/
│       ├── BUILD.bazel              # Generated
│       └── user.proto               # Generated
├── deploy/
│   └── helm/                        # Generated Helm chart
│       ├── Chart.yaml
│       ├── values.yaml
│       └── templates/
├── .mockery.yaml                    # Generated
├── BUILD.bazel                      # Generated
├── go.mod                           # Generated (or updated)
└── Dockerfile                       # Generated
```

---

**Related Specifications:**

- [Architecture](01-architecture.md)
- [Features](02-features.md)
- [Node System](03-node-system.md)
- [Operations](08-operations.md)
